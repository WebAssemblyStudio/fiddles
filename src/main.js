// Note that for webassembly.studio we're using the CLI's `--no-modules` option
// which may not be what you're using locally (aka using ES modules/Webpack).
// Since we're using `--no-modules` the `wasm_bindgen` global is initialized 
// to the exports of our module, and then below initialization is slightly
// different.
//
// When using wasm-bindgen locally and a different bundler like Webpack (or 
// a different option like `--nodejs`) these integration points will be
// tweaked slightly, and you can consult https://github.com/rustwasm/wasm-bindgen
// for more information.

const mod = wasm_bindgen;
counters =[];
function runApp() {
  addCounter();
  let b = document.getElementById('add-counter');
  if (!b) throw new Error('Unable to find #add-counter');
  b.addEventListener('click', ev => addCounter())
}


function addCounter() {
    let ctr = mod.Counter.new(randomChar(), 0);
    counters.push(ctr);
    update();
}

function update() {
    let container = document.getElementById('container');
    if (!container) throw new Error('Unable to find #container in dom');
    while (container.hasChildNodes()) {
        if (container.lastChild.id == "add-counter") break;
        container.removeChild(container.lastChild);
    }
    for (var i = 0; i < counters.length; i++) {
        let counter = counters[i];
        container.appendChild(newCounter(counter.key(), counter.count(), ev => {
            counter.increment();
            update();
        }))
    }
}

function randomChar() {
    console.log('randomChar');
    let idx = Math.floor(Math.random() * (chars.length - 1));
    console.log('index', idx);
    let ret = chars.splice(idx, 1)[0];
    console.log('char', ret);
    return ret;
}

function newCounter(key, value, cb) {
    let container = document.createElement('div');
    container.setAttribute('class', 'counter');
    let title = document.createElement('h1');
    title.appendChild(document.createTextNode('Counter ' + key));
    container.appendChild(title);
    container.appendChild(newField('Count', value));
    let plus = document.createElement('button');
    plus.setAttribute('type', 'button');
    plus.setAttribute('class', 'plus-button');
    plus.appendChild(document.createTextNode('+'));
    plus.addEventListener('click', cb);
    container.appendChild(plus);
    return container;
}

function newField(key, value) {
    let ret = document.createElement('div');
    ret.setAttribute('class', 'field');
    let name = document.createElement('span');
    name.setAttribute('class', 'name');
    name.appendChild(document.createTextNode(key));
    ret.appendChild(name);
    let val = document.createElement('span');
    val.setAttribute('class', 'value');
    val.appendChild(document.createTextNode(value));
    ret.appendChild(val);
    return ret;
}

// Load and instantiate the wasm file, and we specify the source of the wasm
// file here. Once the returned promise is resolved we're ready to go and
// use our imports.
wasm_bindgen('../out/main_bg.wasm').then(runApp);


let chars = [
"!","#","$","%","&","'","(",")","*","+",",",
"-",".","/","0","1","2","3","4","5","6","7",
"8","9",":",";","<","=",">","?","@","A","B",
"C","D","E","F","G","H","I","J","K","L","M",
"N","O","P","Q","R","S","T","U","V","W","X",
"Y","Z","[","]","^","_","`","a","b","c",
"d","e","f","g","h","i","j","k","l","m","n",
"o","p","q","r","s","t","u","v","w","x","y",
"z","{","|","}","~","Â ","Â¡","Â¢","Â£","Â¤","Â¥",
"Â¦","Â§","Â¨","Â©","Âª","Â«","Â¬","Â®","Â¯","Â°",
"Â±","Â²","Â³","Â´","Âµ","Â¶","Â·","Â¸","Â¹","Âº","Â»",
"Â¼","Â½","Â¾","Â¿","Ã€","Ã","Ã‚","Ãƒ","Ã„","Ã…","Ã†",
"Ã‡","Ãˆ","Ã‰","ÃŠ","Ã‹","ÃŒ","Ã","Ã","Ã","Ã","Ã‘",
"Ã’","Ã“","Ã”","Ã•","Ã–","Ã—","Ã˜","Ã™","Ãš","Ã›","Ãœ",
"Ã","Ã","ÃŸ","Ã ","Ã¡","Ã¢","Ã£","Ã¤","Ã¥","Ã¦","Ã§",
"Ã¨","Ã©","Ãª","Ã«","Ã¬","Ã­","Ã®","Ã¯","Ã°","Ã±","Ã²",
"Ã³","Ã´","Ãµ","Ã¶","Ã·","Ã¸","Ã¹","Ãº","Ã»","Ã¼","Ã½",
"Ã¾","Ã¿","Ä€","Ä","Ä‚","Äƒ","Ä„","Ä…","Ä†","Ä‡","Äˆ",
"Ä‰","ÄŠ","Ä‹","ÄŒ","Ä","Ä","Ä","Ä","Ä‘","Ä’","Ä“",
"Ä”","Ä•","Ä–","Ä—","Ä˜","Ä™","Äš","Ä›","Äœ","Ä","Ä",
"ÄŸ","Ä ","Ä¡","Ä¢","Ä£","Ä¤","Ä¥","Ä¦","Ä§","Ä¨","Ä©",
"Äª","Ä«","Ä¬","Ä­","Ä®","Ä¯","Ä°","Ä±","Ä²","Ä³","Ä´",
"Äµ","Ä¶","Ä·","Ä¸","Ä¹","Äº","Ä»","Ä¼","Ä½","Ä¾","Ä¿",
"Å€","Å","Å‚","Åƒ","Å„","Å…","Å†","Å‡","Åˆ","Å‰","ÅŠ",
"Å‹","ÅŒ","Å","Å","Å","Å","Å‘","Å’","Å“","Å”","Å•",
"Å–","Å—","Å˜","Å™","Åš","Å›","Åœ","Å","Å","ÅŸ","Å ",
"Å¡","Å¢","Å£","Å¤","Å¥","Å¦","Å§","Å¨","Å©","Åª","Å«",
"Å¬","Å­","Å®","Å¯","Å°","Å±","Å²","Å³","Å´","Åµ","Å¶",
"Å·","Å¸","Å¹","Åº","Å»","Å¼","Å½","Å¾","Å¿","Æ€","Æ",
"Æ‚","Æƒ","Æ„","Æ…","Æ†","Æ‡","Æˆ","Æ‰","ÆŠ","Æ‹","ÆŒ",
"Æ","Æ","Æ","Æ","Æ‘","Æ’","Æ“","Æ”","Æ•","Æ–","Æ—",
"Æ˜","Æ™","Æš","Æ›","Æœ","Æ","Æ","ÆŸ","Æ ","Æ¡","Æ¢",
"Æ£","Æ¤","Æ¥","Æ¦","Æ§","Æ¨","Æ©","Æª","Æ«","Æ¬","Æ­",
"Æ®","Æ¯","Æ°","Æ±","Æ²","Æ³","Æ´","Æµ","Æ¶","Æ·","Æ¸",
"Æ¹","Æº","Æ»","Æ¼","Æ½","Æ¾","Æ¿","Ç€","Ç","Ç‚","Çƒ",
"Ç„","Ç…","Ç†","Ç‡","Çˆ","Ç‰","ÇŠ","Ç‹","ÇŒ","Ç","Ç",
"Ç","Ç","Ç‘","Ç’","Ç“","Ç”","Ç•","Ç–","Ç—","Ç˜","Ç™",
"Çš","Ç›","Çœ","Ç","Ç","ÇŸ","Ç ","Ç¡","Ç¢","Ç£","Ç¤",
"Ç¥","Ç¦","Ç§","Ç¨","Ç©","Çª","Ç«","Ç¬","Ç­","Ç®","Ç¯",
"Ç°","Ç±","Ç²","Ç³","Ç´","Çµ","Ç¶","Ç·","Ç¸","Ç¹","Çº",
"Ç»","Ç¼","Ç½","Ç¾","Ç¿","È€","È","È‚","Èƒ","È„","È…",
"È†","È‡","Èˆ","È‰","ÈŠ","È‹","ÈŒ","È","È","È","È",
"È‘","È’","È“","È”","È•","È–","È—","È˜","È™","Èš","È›",
"Èœ","È","È","ÈŸ","È ","È¡","È¢","È£","È¤","È¥","È¦",
"È§","È¨","È©","Èª","È«","È¬","È­","È®","È¯","È°","È±",
"È²","È³","È´","Èµ","È¶","È·","È¸","È¹","Èº","È»","È¼",
"È½","È¾","È¿","É€","É","É‚","Éƒ","É„","É…","É†","É‡",
"Éˆ","É‰","ÉŠ","É‹","ÉŒ","É","É","É","É","É‘","É’",
"É“","É”","É•","É–","É—","É˜","É™","Éš","É›","Éœ","É",
"É","ÉŸ","É ","É¡","É¢","É£","É¤","É¥","É¦","É§","É¨",
"É©","Éª","É«","É¬","É­","É®","É¯","É°","É±","É²","É³",
"É´","Éµ","É¶","É·","É¸","É¹","Éº","É»","É¼","É½","É¾",
"É¿","Ê€","Ê","Ê‚","Êƒ","Ê„","Ê…","Ê†","Ê‡","Êˆ","Ê‰",
"ÊŠ","Ê‹","ÊŒ","Ê","Ê","Ê","Ê","Ê‘","Ê’","Ê“","Ê”",
"Ê•","Ê–","Ê—","Ê˜","Ê™","Êš","Ê›","Êœ","Ê","Ê","ÊŸ",
"Ê ","Ê¡","Ê¢","Ê£","Ê¤","Ê¥","Ê¦","Ê§","Ê¨","Ê©","Êª",
"Ê«","Ê¬","Ê­","Ê®","Ê¯","Í²","Í³","Í´","Íµ","Í¶","Í·",
"Íº","Í»","Í¼","Í½","Í¾","Í¿","Î„","Î…","Î†","Î‡","Îˆ","Î‰",
"ÎŠ","ÎŒ","Î","Î",
"Î","Î‘","Î’","Î“","Î”","Î•","Î–","Î—","Î˜","Î™","Îš",
"Î›","Îœ","Î","Î","ÎŸ","Î ","Î¡","Î£","Î¤","Î¥","Î¦",
"Î§","Î¨","Î©","Îª","Î«","Î¬","Î­","Î®","Î¯","Î°","Î±",
"Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼",
"Î½","Î¾","Î¿","Ï€","Ï","Ï‚","Ïƒ","Ï„","Ï…","Ï†","Ï‡",
"Ïˆ","Ï‰","ÏŠ","Ï‹","ÏŒ","Ï","Ï","Ï","Ï","Ï‘","Ï’",
"Ï“","Ï”","Ï•","Ï–","Ï—","Ï˜","Ï™","Ïš","Ï›","Ïœ","Ï",
"Ï","ÏŸ","Ï ","Ï¡","Ï¢","Ï£","Ï¤","Ï¥","Ï¦","Ï§","Ï¨",
"Ï©","Ïª","Ï«","Ï¬","Ï­","Ï®","Ï¯","Ï°","Ï±","Ï²","Ï³",
"Õ•","Õ–","ğŸ•§","ğŸ•¨","ğŸ•©","ğŸ•ª","ğŸ•«","ğŸ•¬","ğŸ•­","ğŸ•®",
"ğŸ•¯","ğŸ•°","ğŸ•±","ğŸ•²","ğŸ•³","ğŸ•´","ğŸ•µ","ğŸ•¶","ğŸ•·","ğŸ•¸",
"ğŸ•¹","ğŸ•º","ğŸ•»","ğŸ•¼","ğŸ•½","ğŸ•¾","ğŸ•¿","ğŸ–€","ğŸ–","ğŸ–‚",
"ğŸ–ƒ","ğŸ–„","ğŸ–…","ğŸ–†","ğŸ–‡","ğŸ–ˆ","ğŸ–‰","ğŸ–Š","ğŸ–‹",
"ğŸ–Œ","ğŸ–","ğŸ–","ğŸ–","ğŸ–","ğŸ–‘","ğŸ–’","ğŸ–“","ğŸ–”","ğŸ–•",
"ğŸ––","ğŸ–—","ğŸ–˜","ğŸ–™","ğŸ–š","ğŸ–›","ğŸ–œ","ğŸ–","ğŸ–","ğŸ–Ÿ",
"ğŸ– ","ğŸ–¡","ğŸ–¢","ğŸ–£","ğŸ–¤","ğŸ–¥","ğŸ–¦","ğŸ–§","ğŸ–¨","ğŸ–©",
"ğŸ–ª","ğŸ–«","ğŸ–¬","ğŸ–­","ğŸ–®","ğŸ–¯","ğŸ–°","ğŸ–±","ğŸ–²","ğŸ–³",
"ğŸ–´","ğŸ–µ","ğŸ–¶","ğŸ–·","ğŸ–¸","ğŸ–¹","ğŸ–º","ğŸ–»","ğŸ–¼","ğŸ–½",
"ğŸ–¾","ğŸ–¿","ğŸ—€","ğŸ—","ğŸ—‚","ğŸ—ƒ","ğŸ—„","ğŸ—…","ğŸ—†","ğŸ—‡",
"ğŸ—ˆ","ğŸ—‰","ğŸ—Š","ğŸ—‹","ğŸ—Œ","ğŸ—","ğŸ—","ğŸ—","ğŸ—","ğŸ—‘","ğŸ—’",
"ğŸ—“","ğŸ—”","ğŸ—•","ğŸ—–","ğŸ——","ğŸ—˜","ğŸ—™","ğŸ—š","ğŸ—›","ğŸ—œ",
"ğŸ—","ğŸ—","ğŸ—Ÿ","ğŸ— ","ğŸ—¡","ğŸ—¢","ğŸ—£","ğŸ—¤","ğŸ—¥","ğŸ—¦",
"ğŸ—§","ğŸ—¨","ğŸ—©","ğŸ—ª","ğŸ—«","ğŸ—¬","ğŸ—­","ğŸ—®","ğŸ—¯","ğŸ—°",
"ğŸ—±","ğŸ—²","ğŸ—³","ğŸ—´","ğŸ—µ","ğŸ—¶","ğŸ—·","ğŸ—¸","ğŸ—¹","ğŸ—º",
"ğŸ—»","ğŸ—¼","ğŸ—½","ğŸ—¾","ğŸ—¿","ğŸ˜€"];
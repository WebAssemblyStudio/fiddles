<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      background-color: rgb(0, 0, 0);
    }
    #editorbg {
      background-color: rgb(5, 20, 20);
      height: 110%;
    }

    .text {
      color: white;
      font-family: monospace;
      margin-top: 2vh;
      margin-bottom: 2vh;
      margin-left: 1vw;
      display: block;
      font-size: 1em;
    }

    pre {
      color: white;
      font-family: monospace;
      margin-top: 2vh;
      margin-bottom: 2vh;
      margin-left: 1vw;
      width:90%;
      display: inline-block;
      transition: all 0.2s;
      
    }
    pre:hover {
      background-color: rgb(10, 25, 25);
    }

    #check {
      background-color: #4CAF50;
      border: 2px solid rgb(5, 20, 20);
      color: white;
      padding: 10px 15px;
      text-align: center;
      text-decoration: none;
      display: block;
      font-size: 0.7em;
      margin: 4px 2px;
      cursor: pointer;
      transition: all 0.2s;
    }
    #check:hover {
      background-color:red;
      border: 2px solid white;
    }
    #check:active {
      background-color:white;
      border: 2px solid black;
      color:black;
    }

    #sizebg {
      position: absolute;
      right: 4vw;
      height: 40vh;
      width: 3vw;
      background-color: rgba(130, 130, 130,0.5);
      transition: all 0.2s;
    }
    #size-slider {
      position: absolute;
      right: 0.03vw;
      height: 20vh;
      width: 3vw;
      background-color: rgba(200, 80, 80,0.5);
      transition: all 0.2s;
    }
    #minus {
      position: absolute;
      right: 0.03vw;
      top: 3vh;
      color:white;
      font-size: 1.5em;
      transition: all 0.2s;
      width:2.1vw;
      height:9vh;
    }

    #plus {
      position: absolute;
      right: 0.09vw;
      top: 30vh;
      color:white;
      font-size: 1em;
      transition: all 0.2s;
      width:2.1vw;
      height:6vh;
    }

#size:hover {
  opacity: 1;
}

  </style>
</head>
<body>
  <span id="container"></span>
  <p class="big-text text">B&sup2; Editor and Compiler</p>
  <div id="editorbg">

    <div id="sizebg">
      <div id="plus">+</div>
      <div id="minus">-</div>
      <div id="size-slider"></div>
    </div>

    <p class="text">Input (Type!):</p>
  <pre contenteditable="true" id="editor">
// Type text here //
add 5 6 ;
add 10 11 ;
subtract 100 10 ;
</pre>
<button id="check">Highlight</button>
<p class="text">.WAT Compiled File:</p>
<pre id="output">
(; Output goes here ;)
</pre>
</div>
  <script src="./main.js"></script>



  <script>
    // FONT SIZE SLIDER
    var fontSize = 1;
    document.getElementById("plus").onclick = ()=>{
      fontSize += 0.1;
      updateSize();
    };

    document.getElementById("minus").onclick = ()=>{
      fontSize -= 0.1;
      updateSize();
    };

    function updateSize() {
      document.getElementById("editor").style.fontSize = fontSize+"em";
      document.getElementById("output").style.fontSize = fontSize+"em";
      document.getElementById("size-slider").style.height = fontSize*20+"vh";
    }

    // SYNTAX HIGHLIGHTING

document.getElementById("check").onclick = function () {
  update();
}

/*
*  This code's purpose is to update at the right time. It is taken from https://schier.co/blog/wait-for-user-to-stop-typing-using-javascript.
*/

let timeout = null;

document.getElementById('editor').addEventListener('keyup', function (e) {
    clearTimeout(timeout);
    timeout = setTimeout(function () {
        update();
    }, 8000);
});

// end



var contents = document.getElementById("editor").innerHTML;
var words = contents.split(" ");
window.onload = function () {
update();
}

function update() {
contents = document.getElementById("editor").innerHTML;
contents = contents.split(" ").join(" space ");
contents = contents.split("\n").join(" newline ");

words = contents.split(" ");


for(var i = 0; i <= words.length-1; i++) {
   // keywords
  if(words[i] == "add") {
    updateAll(i, "red");
  }
  if(words[i] == "subtract") {
    updateAll(i, "orange");
  }

  // various
  if(words[i] == "//") { 
    updateAll(i, "green");
  }
  
}

function updateAll(pos, color) {
    words.splice(pos,0, "<span style='color: " + color + "'>");
    words.splice(pos+2,0, "</span>");
    for(var i = 0; i <= words.length-1; i++) {
      if(words[i] == "newline") {
        words[i] = "\n";
      }
      if(words[i] == "space") {
        words[i] = " ";
      }
    }
    words = words.join("");
    document.getElementById("editor").innerHTML = words;
    contents = document.getElementById("editor").innerHTML;
    contents = contents.split(" ").join(" space ");
    contents = contents.split("\n").join(" newline ");

    words = contents.split(" ");
    
  }
}
  </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
</head>
<body style="background: #fff">
<span id="container"></span>
<script type="module">
import loader from "https://cdn.jsdelivr.net/npm/@assemblyscript/loader/index.js";

var myModule;

loader.instantiateStreaming(fetch("../out/main.wasm"), {
  myConsole: {
    log(messagePtr) { // Called as `console.log` in assembly/main.ts
      console.log(myModule.__getString(messagePtr));
    }
  },
  env: {
    abort(_msg, _file, line, column) {
      console.error("abort called (" + myModule.__getString(_msg) + ") at " + myModule.__getString(_file) + ": " + line + ":" + column);
    },
    trace(msg, n) {
      console.log("trace: " + myModule.__getString(msg) + (n ? " " : "") + Array.prototype.slice.call(arguments, 2, 2 + n).join(", "));
    }
  },
}).then(module => {
  myModule = module.exports;
  let result = document.getElementById("container");
  result.innerHTML = "Call add(1, 2) = " + myModule.add(1, 2);
  result.innerHTML += ("<br>Call hello() = " + myModule.hello());
  result.innerHTML += ("<br>Call __getString(hello()) = " + myModule.__getString(myModule.hello()));
  result.innerHTML += ("<br>Call sayHello() = " + myModule.sayHello());
}).catch(console.error);
</script>
</body>
</html>
